<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>두드리기 챌린지</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #111;
        color: #fff;
        text-align: center;
        user-select: none;
      }

      h1 {
        margin-top: 20px;
      }

      #game-area {
        height: 70vh;
        background-color: #222;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        border: 3px dashed #444;
        margin: 20px;
        border-radius: 10px;
      }

      #tap-image {
        width: 90%;
        max-width: 800px;
        border-radius: 15px;
        transition: opacity 0.2s;
      }

      button {
        padding: 15px 30px;
        font-size: 1.2rem;
        margin: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
      }

      #start-btn {
        background-color: #4caf50;
        color: white;
      }

      #reset-btn {
        background-color: #f44336;
        color: white;
      }

      #score-board {
        margin-top: 20px;
      }

      #record-list {
        margin-top: 20px;
        text-align: left;
        max-width: 400px;
        margin-inline: auto;
      }
    </style>
  </head>
  <body>
    <h1>쿨코 스내치 게임😁</h1>
    <div>
      <button id="start-btn">시작하기</button>
      <button id="reset-btn">기록 초기화</button>
    </div>

    <div id="game-area">
      <img id="tap-image" src="image1.png" alt="이미지" />
    </div>

    <div id="score-board">
      점수: <span id="score">0</span> / 남은 시간: <span id="time">10</span>s
    </div>

    <h2>📊 나의 기록</h2>
    <ul id="record-list"></ul>

    <script>
      const startBtn = document.getElementById('start-btn');
      const resetBtn = document.getElementById('reset-btn');
      const gameArea = document.getElementById('game-area');
      const tapImage = document.getElementById('tap-image');
      const scoreDisplay = document.getElementById('score');
      const timeDisplay = document.getElementById('time');
      const recordList = document.getElementById('record-list');

      const imgList = ['image1.png', 'image2.png', 'image3.png'];
      let currentImgIndex = 0;

      let score = 0;
      let time = 10;
      let timer;
      let playing = false;

      function startGame() {
        if (playing) return;

        score = 0;
        time = 10;
        currentImgIndex = 0;
        tapImage.src = imgList[currentImgIndex];
        playing = true;
        scoreDisplay.textContent = score;
        timeDisplay.textContent = time;

        timer = setInterval(() => {
          time--;
          timeDisplay.textContent = time;
          if (time <= 0) {
            clearInterval(timer);
            playing = false;
            saveRecord(score);
            alert(`게임 종료! 점수: ${score}`);
          }
        }, 1000);
      }

      function saveRecord(newScore) {
        const records = JSON.parse(localStorage.getItem('tapRecords') || '[]');
        records.push({
          score: newScore,
          date: new Date().toLocaleString(),
        });
        records.sort((a, b) => b.score - a.score); // 높은 점수 순
        localStorage.setItem(
          'tapRecords',
          JSON.stringify(records.slice(0, 10))
        ); // 상위 10개 저장
        displayRecords();
      }

      function displayRecords() {
        const records = JSON.parse(localStorage.getItem('tapRecords') || '[]');
        recordList.innerHTML = '';
        records.forEach((r, i) => {
          const li = document.createElement('li');
          li.textContent = `${i + 1}위 - ${r.score}회 (${r.date})`;
          recordList.appendChild(li);
        });
      }

      function handleTap() {
        if (!playing) return;

        // 점수 증가
        score++;
        scoreDisplay.textContent = score;

        // 이미지 변경
        currentImgIndex = (currentImgIndex + 1) % imgList.length;
        tapImage.src = imgList[currentImgIndex];
      }

      tapImage.addEventListener('click', handleTap);
      tapImage.addEventListener('touchstart', handleTap);

      startBtn.addEventListener('click', startGame);
      resetBtn.addEventListener('click', () => {
        localStorage.removeItem('tapRecords');
        displayRecords();
      });

      displayRecords();
    </script>
  </body>
</html>
